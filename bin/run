#!/usr/bin/env python
# -*- coding: utf-8 -*-

from __future__ import (
    absolute_import, division, print_function, unicode_literals)

import requests

from importlib import import_module
from pprint import pprint
from optparse import OptionParser
from pipe2py import Context


def _load_json(json):
    try:
        loaded = loads(json.encode('utf-8'))
    except UnicodeDecodeError:
        loaded = loads(json)

    return loaded


if __name__ == '__main__':
    usage = 'usage: %prog [pipeid]'
    parser = OptionParser(usage=usage)
    (options, args) = parser.parse_args()

    pipe_name = 'pipe_%s' % args[0]

    try:
        module = import_module('pipe2py.pypipelines.%s' % pipe_name)
    except ImportError:
        module = import_module('tests.pypipelines.%s' % pipe_name)

    pipe_generator = getattr(module, pipe_name)
    pprint(pipe_generator(Context(test=True, verbose=True)).next())
